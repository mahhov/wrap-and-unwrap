<style>
  body,
  .center {
    display: flex;
    align-items: center;
  }

  .center {
    flex-direction: column;
    flex-grow: 1;
  }

  .container > div {
    margin-top: 15px;
  }

  input {
    margin-left: 15px;
  }

  textarea,
  pre {
    padding: 5px;
    margin: 0;
    font-size: 14px;
  }

  pre {
    position: fixed;
    border-right: 1px solid;
    pointer-events: none;
  }

  button {
    background: white;
    border: black 1px solid;
    cursor: pointer;
  }

  button:hover {
    background: #eee;
  }

  button:active {
    background: white;
  }
</style>

<div class="center">
  <div class="container">
    <div><label>width<input id="width" type="number" value="72" min="1"></label></div>
    <div>
      <pre id="overlay"></pre>
      <textarea id="input" cols="100" rows="50" autofocus></textarea>
    </div>
    <div>
      <button id="copy" accesskey="c">Copy [alt+c]</button>
      <div id="copy-notification"></div>
    </div>
  </div>
</div>

<script>
  let $ = document.getElementById.bind(document);
  let widthInput = $('width');
  let overlay = $('overlay');
  let input = $('input');
  let copyButton = $('copy');
  let copyNotification = $('copy-notification');

  let updateOverlayWidth = () =>
      overlay.textContent = (' '.repeat(width()) + '\n').repeat(input.rows);

  let width = () => widthInput.value;
  widthInput.addEventListener('input', updateOverlayWidth);

  document.body.addEventListener('keydown', () => {
    if (document.activeElement !== widthInput)
      input.focus();
  });

  let setOutput = (text, selection) => {
    input.value = text;
    input.setSelectionRange(selection, selection);
  };

  let inputHistory = [['']];
  let inputHistoryIndex = 0;
  input.addEventListener('input', ({inputType}) => {
    switch (inputType) {
      case 'historyUndo':
        setOutput(...inputHistory[--inputHistoryIndex]);
        break;

      case 'historyRedo':
        setOutput(...inputHistory[++inputHistoryIndex]);
        break;

      default:
        let selection = input.selectionStart;
        let text = input.value
            .replace(/([^\n ])\n([^\n])/g, '$1 $2')
            .replace(new RegExp(`(.{1,${width()}})[ \\n]`, 'g'), '$1\n');
        setOutput(text, selection);

        inputHistory[++inputHistoryIndex] = [text, selection];
        inputHistory.splice(inputHistoryIndex + 1);
    }
  });

  let notify = (value, duration = 3000) => {
    copyNotification.textContent = value;
    setTimeout(() => copyNotification.textContent = '', duration);
  };
  copyButton.addEventListener('click', () => {
    navigator.clipboard.writeText(input.value)
        .then(() => notify('copied'))
        .catch(e => notify('error copying: ' + e));
  });

  updateOverlayWidth();
</script>
